workflows:
  ios-workflow:
    name: iOS Release Workflow
    instance_type: mac_mini_m1
    max_build_duration: 120
    environment:
      xcode: latest
      cocoapods: default
      flutter: stable
      ios_signing:
        distribution_type: app_store
        bundle_identifier: com.custombank.app
      vars:
        CERTIFICATE_PASSWORD: "Making2Money"
        CERTIFICATE_P12: "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"
    scripts:
      - name: Set up code signing
        script: |
          echo $CERTIFICATE_P12 | base64 --decode > certificate.p12
          keychain initialize
          keychain add-certificates \
            --certificate certificate.p12 \
            --certificate-password $CERTIFICATE_PASSWORD

      - name: Get Flutter packages
        script: |
          flutter pub get
          
      - name: Install pods
        script: |
          cd ios && pod install
          
      - name: Flutter build ipa
        script: |
          flutter build ipa --release \
            --export-options-plist=ios/ExportOptions.plist
            
    artifacts:
      - build/ios/ipa/*.ipa
      
    publishing:
      app_store_connect:
        api_key: $APP_STORE_CONNECT_PRIVATE_KEY
        key_id: $APP_STORE_CONNECT_KEY_IDENTIFIER 
        issuer_id: $APP_STORE_CONNECT_ISSUER_ID
        submit_to_testflight: true