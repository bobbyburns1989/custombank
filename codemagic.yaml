workflows:
 ios-workflow:
   name: iOS Release Workflow
   instance_type: mac_mini_m1
   max_build_duration: 120
   environment:
     xcode: latest
     cocoapods: default
     flutter: stable
     ios_signing:
       distribution_type: app_store
       bundle_identifier: VS8295GFH3.com.custombank.app
   scripts:
     - name: Set up iOS code signing
       script: |
         keychain initialize
         app-store-connect fetch-signing-files VS8295GFH3.com.custombank.app --type IOS_APP_STORE
         keychain add-certificates
         
     - name: Get Flutter packages
       script: |
         flutter pub get
         
     - name: Install pods
       script: |
         find . -name "Podfile" -execdir pod install \;
         
     - name: Build iOS
       script: |
         flutter build ipa --release \
           --bundle-identifier=VS8295GFH3.com.custombank.app \
           --export-method=app-store
         
   artifacts:
     - build/ios/ipa/*.ipa
     
   publishing:
     app_store_connect:
       api_key: $APP_STORE_CONNECT_PRIVATE_KEY  
       key_id: $APP_STORE_CONNECT_KEY_IDENTIFIER
       issuer_id: $APP_STORE_CONNECT_ISSUER_ID
       submit_to_testflight: true
       beta_groups:
         - "CustomBank Beta Testers"